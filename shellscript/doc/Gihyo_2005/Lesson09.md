# Lesson09

現行では、文字列置換は外部のsedに頼るのではなくshがもつ文字置換で行う。
sedが輝くのはlogファイルのような複数行のテキストデータを置換するとき[^1]

## sedとawk

### sed

sedはスクリプト型言語の一種

#### 置換方法

sコマンドを用いることで、正規表現を用いてパターンに一致した文字列を別の文字で置き換えということができる。

```bash
sed 's/パターン/文字列/'  #パターンに一致した最初の一つだけ書き換え
sed 's/パターン/文字列/g' #パターンに一致したすべてを書き換え
```

## awk

awkもスクリプト型言語の一種
本が一冊かけるほど機能が豊富

標準入力された行とパターンが一致した時にその行に対してコマンドを実行する。

```shellscript
awk '
/pattern/ { command; }
```

「`prg0902.sh`」

```bash
a
prg
program
aa prg h
program
```

パターンには以下の表が扱える

|主なパターン| 説明 |
|:--:|:-- |
| `/ERE/` |入力行が拡張正規表現と一致したらコマンドを実行|
| `(eq)`  |式が真なら実行（`awk`は真が0偽が0以外）|
| `BEGIN` |入力前に無条件に実行|
|  `END`  |入力後に無条件に実行|
|パターンなし|無条件に実行|

また、変数は以下のように定義

| 変数名 | 意味 |
|:--:|:-- |
|`$0`|入力行全体|
|`$1`|入力行を分割した最初の単語（分割とはタブ、スペース等区切られた文字列）|
|`$2`|2番目の単語（３番目以降も同様）|

## 演習

1. 「標準入力から入力し、入力行野中の文字列`aaa`を`xxx`に置き換える」というシェルスクリプトを、`sed`を使って作成せよ。
ただし
2. 「標準入力から入力し、入力行中のスラッシュを消す」というシェルスクリプトを`sed`を使って作成せよ。
3. 「標準入力から入力し、入力値が以下のように西暦年月日形式である場合にはスラッシュを消し、かつ年を２ケタだけにする」というシェルスクリプトを、`sed`を使って作成せよ。
    - 1234/56/78 -> 345678
    - 2005/01/02 -> 050102
4. 以下の動作をするシェルスクリプトを、`awk`を使って作成せよ
    - 標準入力から値を入力をする
    - 第１変数と第２変数を表示する
    - 入力した第１変数が第２変数より大きければ`big`と表示する
5. 4.のシェルスクリプトに以下の機能を追加実装せよ。
    - 入力前に`Hello`と表示する
    - 入力終了後に`Good bye`と表示する

[^1]: [【脱sed】いい加減シェルスクリプトで文字列をsedで置換するなんてやめよう](https://qiita.com/ko1nksm/items/b4b342f77f6d3ee1a0a9)
